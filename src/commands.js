const {Extra, Markup} = require('telegraf')
const calendar = require('./calendar')

exports.middleware = (bot) => {
bot.start(async (ctx) => {
    await ctx.reply(`
        –ü—Ä–∏–≤–µ—Ç ${ctx.from.first_name}!\n–ü–æ–ø—Ä–æ–±—É–π –Ω–∞—á–∞—Ç—å —Å–æ / (—Å–ª–µ—à–∞)
    `)
    // const ForwardMessage = await ctx.tg.forwardMessage(ctx.chat.id)
    // console.log(`Forward message: ${ForwardMessage}`)

    const ChatId = ctx.chat.id
    console.log(`Chat_Id: ${ChatId}`)
})

bot.help(async ctx => await ctx.replyWithHTML(
    `
<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/search<pre>[-e|m|d]</pre> -- –ø–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏—è, –≤—Å—Ç—Ä–µ—á–∏, –ø–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: /help_search
/add<pre>[-e|m|d]</pre> -- –¥–æ–±–∞–≤–∏—Ç—å. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: /help_add
/upd<pre>[-e|m|d]</pre> -- –æ–±–Ω–æ–≤–∏—Ç—å. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: /help_upd
/calen -- —Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: /help_calen
/settings -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–º–æ—â–Ω–∏–∫–∞
    `
))

bot.settings(({
    reply
}) => {
    reply('One time keyboard', Markup
        .keyboard(['/theme', '/inline', '/prenotice'])
        .oneTime()
        .resize()
        .extra()
    )
})

bot.command('help_search', async ctx => await ctx.replyWithHTML(
    `
/search <code>&lt;name&gt;</code> --–ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é "name"
–ø–æ –≤—Å–µ–º —Å–ø–∏—Å–∫–∞–º

/search [-flag] &lt;name|date&gt; [time] -- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ü–∏—é –ø–æ–∏—Å–∫–∞, —Ñ–ª–∞–≥–∏ –º–æ–∂–Ω–æ —Å–æ–≤–º–µ—â–∞—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–∞–Ω–¥–∞ "/search -e birthday " –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "
birthday ", –∞ –∫–æ–º–∞–Ω–¥–∞ " /search -em birthday " -- –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –∏ —Å–æ–±—ã—Ç–∏–µ, –∏ –≤—Å—Ç—Ä–µ—á—É "
birthday "
–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–ª–∞–≥–∏:
    -e -- –ø–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    -m -- –ø–æ–∏—Å–∫ –≤—Å—Ç—Ä–µ—á–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    -d &lt;dd.mm.yy[yy]&gt; -- –ø–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∞—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –ª–∏–±–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª —á–µ—Ä–µ–∑ —Ç–∏—Ä–µ, –ª–∏–±–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª. –£–∫–∞–∑–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ".mm.yy" –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É "01.mm.yy-31.mm.yy". –¢–æ –∂–µ —Å–∞–º–æ–µ –∏ —Å "dd..yy" –∏ "dd.mm."
    -t &lt;hh:mm&gt;-- –ø–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –ª–∏–±–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª —á–µ—Ä–µ–∑ —Ç–∏—Ä–µ, –ª–∏–±–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª. –£–∫–∞–∑–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "hh:" –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É "hh:00-hh:59". –ü–æ–º–∏–Ω—É—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.
    `
))

bot.command('help_add', async ctx => await ctx.replyWithHTML(
    `
/add [-flag] &lt;name&gt; &lt;date&gt; [time] -- –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ, –≤—Å—Ç—Ä–µ—á—É, —É—Å–ª–æ–≤–∏–µ. –§–ª–∞–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ü–∏—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —Ñ–ª–∞–≥–∏ –º–æ–∂–Ω–æ —Å–æ–≤–º–µ—â–∞—Ç—å.
    -e -- –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
    -m -- –¥–æ–±–∞–≤–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É
    -c -- –¥–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ
    `
))

bot.command('help_upd', async ctx => await ctx.replyWithHTML(
    `
/upd [-flag] &lt;name&gt;[:rename] [date] [time]-- –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤—Å—Ç—Ä–µ—á—É –∏–ª–∏ —É—Å–ª–æ–≤–∏–µ. –§–ª–∞–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ü–∏—é, —Ñ–ª–∞–≥–∏ –º–æ–∂–Ω–æ —Å–æ–≤–º–µ—â–∞—Ç—å.
    -e -- –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
    -m -- –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É
    -—Å -- –æ–±–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ
    `
))

bot.command('help_calen', async ctx => await ctx.replyWithHTML(
    `
/calen -- –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
    `
))

bot.command('search', async ctx => await ctx.reply('–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –µ—â–µ üü•'))
bot.command('add', async ctx => await ctx.reply('–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –µ—â–µ üßß'))
bot.command('upd', async ctx => await ctx.reply('–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –µ—â–µ'))

bot.hears('/calen', async ctx => await calendar(ctx))

bot.hears(/\/calen ((\d{0,2})\.(\d{0,2}).(\d{0,4}))/, async ctx => await calendar(ctx, `${ctx.match[4]}-${ctx.match[3]}-${ctx.match[2]}`))

bot.hears(/\/calen (.+)/, async ctx => await ctx.reply('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–µ /help_calen'))

// –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
bot.hears(/\/(.+)?/, async ctx => await ctx.reply('–ù–µ—Ç —Ç–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã —á—Ç–æ –ª–∏'))

}